/*
 * AUTOMATICALLY GENERATED FILE - DO NOT EDIT
 */

// Generated from /home/duck/gitclones/erpc/erpcgen/src/templates/c_server_source.template
extern const char * const kCServerSource;

const char * const kCServerSource = 
"{% if mlComment != \"\"%}\n"
"{$mlComment}\n"
"\n"
"{% endif %}\n"
"{$commonHeader()}\n"
"\n"
"#include \"{$serverHeaderName}\"\n"
"#include <new>\n"
"#include \"erpc_port.h\"\n"
"{% if dynamicServices == false %}\n"
"#include \"erpc_manually_constructed.h\"\n"
"{% endif --dynamicServices == false %}\n"
"{% if empty(group.includes) == false %}\n"
"extern \"C\"\n"
"{\n"
"{%  for inc in group.includes %}\n"
"#include \"{$inc}\"\n"
"{%  endfor -- group.includes %}\n"
"}\n"
"{% endif -- empty(group.includes) %}\n"
"\n"
"{$checkVersion()}\n"
"{$>checkCrc()}\n"
"using namespace erpc;\n"
"using namespace std;\n"
"\n"
"#if ERPC_NESTED_CALLS_DETECTION\n"
"extern bool nestingDetection;\n"
"#endif\n"
"\n"
"{% for iface in group.interfaces if dynamicServices == false %}\n"
"static ManuallyConstructed<{$iface.serviceClassName}> s_{$iface.serviceClassName};\n"
"\n"
"{% endfor -- iface %}\n"
"{$generateCrcVariable()}\n"
"{$> setSharedMemAddresses()}\n"
"{% if unitTest %}\n"
"{$> callbackTable(functions)}\n"
"{% endif %}\n"
"{$> constantsDefinitions(consts)}\n"
"{$> symbolHeader(group.symbolsMap.symbolsToServer, \"deserial\", \"def\")}\n"
"{$> symbolSource(group.symbolsMap.symbolsToServer, \"deserial\", \"def\")}\n"
"{$> symbolHeader(group.symbolsMap.symbolsToClient, \"serial\", \"def\")}\n"
"{$> symbolSource(group.symbolsMap.symbolsToClient, \"serial\", \"def\")}\n"
"{$> symbolFreeSpaceHeader(group.symbolsMap.symbolsServerFree, \"def\")}\n"
"{$> symbolFreeSpaceSource(group.symbolsMap.symbolsServerFree, \"def\")}\n"
"{$> symbolHeader(group.symbolsMap.symbolsToServer, \"deserial\", \"noSharedMem\")}\n"
"{$> symbolSource(group.symbolsMap.symbolsToServer, \"deserial\", \"noSharedMem\")}\n"
"{$> symbolHeader(group.symbolsMap.symbolsToClient, \"serial\", \"noSharedMem\")}\n"
"{$> symbolSource(group.symbolsMap.symbolsToClient, \"serial\", \"noSharedMem\")}\n"
"{$> symbolFreeSpaceHeader(group.symbolsMap.symbolsServerFree, \"noSharedMem\")}\n"
"{$> symbolFreeSpaceSource(group.symbolsMap.symbolsServerFree, \"noSharedMem\")}\n"
"{% def serverShimCode(fn, serverIDName, functionIDName) ------------------------- serverShimCode(fn, serverIDName, functionIDName) %}\n"
"{% set serverIndent = \"\" >%}\n"
"{% if (fn.isReturnValue || fn.isSendValue) && generateErrorChecks %}\n"
"    erpc_status_t err = kErpcStatus_Success;\n"
"\n"
"{% endif -- isReturnValue || isSendValue %}\n"
"{% for param in fn.parameters %}\n"
"    {$param.variable}{% if param.isNullParam %} = NULL{%endif%};\n"
"{%  if !empty(param.nullVariable) %}\n"
"    {$param.nullVariable} = NULL;\n"
"{%  endif %}\n"
"{%  if !param.shared %}\n"
"{%   if param.isNullable == false && param.direction != OutDirection %}\n"
"{$> addIndent(\"    \", allocMem(param.mallocServer))}\n"
"{%   endif -- !param.isNullable && param.direction != OutDirection %}\n"
"{%  endif -- shared %}\n"
"{% endfor -- param %}\n"
"{% if fn.needNullVariableOnServer %}\n"
"    bool isNull;\n"
"{% endif -- needNullVariableOnServer %}\n"
"{% if fn.needTempVariableServer %}\n"
"    int32_t _tmp_local;\n"
"{% endif %}\n"
"{% if fn.returnValue.type.isNotVoid %}\n"
"    {$fn.returnValue.resultVariable}{% if fn.returnValue.isNullReturnType %} = NULL{%endif%};\n"
"{% endif %}\n"
"{% if fn.isReturnValue || fn.isSendValue  %}\n"
"\n"
"{% endif %}\n"
"    // startReadMessage() was already called before this shim was invoked.\n"
"\n"
"{% if fn.isSendValue %}\n"
"{%  for param in fn.parameters if (param.serializedDirection == \"\" || param.serializedDirection == OutDirection || param.referencedName != \"\") %}\n"
"{%   if param.isNullable %}\n"
"{$addIndent(\"    \", f_paramIsNullableDecode(param))}\n"
"\n"
"{%   else -- notNullable %}\n"
"{%    if param.direction != OutDirection %}\n"
"{$addIndent(\"    \", param.coderCall.decode(param.coderCall))}\n"
"\n"
"{%    endif -- param != OutDirection %}\n"
"{%   endif -- isNullable %}\n"
"{%  endfor -- parametersToServer %}\n"
"{% endif -- isSendValue %}\n"
"{% for param in fn.parametersToClient %}\n"
"{%  if !param.shared %}\n"
"{%   if param.isNullable == false && param.direction == OutDirection && empty(param.mallocServer) == false %}\n"
"{$> addIndent(\"    \", allocMem(param.mallocServer))}\n"
"\n"
"{%   endif -- !param.isNullable && param.direction == OutDirection %}\n"
"{%  endif -- shared %}\n"
"{% endfor -- param %}\n"
"{% if (fn.isReturnValue || fn.isSendValue) && generateErrorChecks %}\n"
"{%  set serverIndent = \"    \" >%}\n"
"    err = codec->getStatus();\n"
"    if (err == kErpcStatus_Success)\n"
"    {\n"
"{% endif -- generateErrorChecks %}\n"
"{$serverIndent}    // Invoke the actual served function.\n"
"#if ERPC_NESTED_CALLS_DETECTION\n"
"{$serverIndent}    nestingDetection = true;\n"
"#endif\n"
"{% if serverIDName == \"serviceID\" %}\n"
"{%  for callbackFunction in callbackType.functions %}\n"
"{$serverIndent}    {% if loop.first == false %}else {% endif %}if ({$serverIDName} == {$callbackFunction.serviceId} && {$functionIDName} == {$callbackFunction.id})\n"
"{$serverIndent}    {\n"
"{$serverIndent}        {$callbackFunction.serverPrototype}\n"
"{$serverIndent}    }\n"
"{%  endfor -- callbackFunction in callbackType.functions %}\n"
"{% else -- serverIDName == \"serviceID\" %}\n"
"{$serverIndent}    {$fn.serverPrototype}\n"
"{% endif --serverIDName == \"serviceID\" %}\n"
"#if ERPC_NESTED_CALLS_DETECTION\n"
"{$serverIndent}    nestingDetection = false;\n"
"#endif\n"
"{% if fn.isReturnValue %}\n"
"\n"
"{$serverIndent}    // preparing MessageBuffer for serializing data\n"
"{$serverIndent}    {% if generateErrorChecks %}err = {% endif %}messageFactory->prepareServerBufferForSend(codec->getBuffer());\n"
"{%  if generateErrorChecks %}\n"
"    }\n"
"\n"
"    if (err == kErpcStatus_Success)\n"
"    {\n"
"{%  endif -- generateErrorChecks %}\n"
"{$serverIndent}    // preparing codec for serializing data\n"
"{$serverIndent}    codec->reset();\n"
"\n"
"{$serverIndent}    // Build response message.\n"
"{$serverIndent}    codec->startWriteMessage(kReplyMessage, {$serverIDName}, {$functionIDName}, sequence);\n"
"{%  for param in fn.parametersToClient if (param.serializedDirection == \"\" || param.serializedDirection == InDirection || param.referencedName != \"\") %}\n"
"\n"
"{%   if param.isNullable %}\n"
"{$serverIndent}    if ({% if source == \"server\" && empty(param.nullVariable) == false %}_{% endif %}{$param.name} != NULL)\n"
"{$serverIndent}    {\n"
"{$addIndent(serverIndent & \"        \", param.coderCall.encode(param.coderCall))}\n"
"{$serverIndent}    }\n"
"{%   else -- isNullable %}\n"
"{$addIndent(serverIndent & \"    \", param.coderCall.encode(param.coderCall))}\n"
"{%   endif -- isNullable %}\n"
"{%  endfor -- parametersToClient %}\n"
"{%  if fn.returnValue.type.isNotVoid %}\n"
"\n"
"{%   if fn.returnValue.isNullable %}\n"
"{$addIndent(serverIndent & \"    \", f_paramIsNullableEncode(fn.returnValue))}\n"
"{%   else -- isNullable %}\n"
"{$addIndent(serverIndent & \"    \", fn.returnValue.coderCall.encode(fn.returnValue.coderCall))}\n"
"{%   endif -- isNullable %}\n"
"{%  endif -- notVoid %}\n"
"{%  if generateErrorChecks %}\n"
"\n"
"        err = codec->getStatus();\n"
"{%  endif generateErrorChecks %}\n"
"{% endif -- isReturnValue %}\n"
"{% if (fn.isReturnValue || fn.isSendValue) && generateErrorChecks %}\n"
"    }\n"
"\n"
"{% endif -- fn.isReturnValue || fn.isSendValue %}\n"
"{% for param in fn.paramsToFree %}\n"
"{$> addIndent(\"    \", param.coderCall.freeingCall(param.coderCall))}\n"
"{$> addIndent(\"    \", param.firstFreeingCall1.firstFreeingCall(param.firstFreeingCall1))}\n"
"\n"
"{% endfor -- parameters %}\n"
"{% if fn.returnValue.type.isNotVoid %}\n"
"{%  set needFreeingCall = fn.returnValue.coderCall.freeingCall(fn.returnValue.coderCall) %}\n"
"{%  set needFirstFreeingCall = fn.returnValue.firstFreeingCall1.firstFreeingCall(fn.returnValue.firstFreeingCall1) %}\n"
"{%  if empty(needFreeingCall) == false || empty(needFirstFreeingCall) == false %}\n"
"{$> addIndent(\"    \", needFreeingCall)}\n"
"{$> addIndent(\"    \", needFirstFreeingCall)}\n"
"\n"
"{%  endif -- !empty(needFreeingCall) || !empty(needFirstFreeingCall) %}\n"
"{% endif -- notVoid %}\n"
"{% if (fn.isReturnValue || fn.isSendValue) && generateErrorChecks %}\n"
"    return err;\n"
"{% else %}\n"
"    return codec->getStatus();\n"
"{% endif %}\n"
"{% enddef --------------------------------------------------------------------------------- serverShimCode(fn, serverIDName, functionIDName) %}\n"
"{% for callbackType in group.callbacks %}\n"
"\n"
"// Common function for serializing and deserializing callback functions of same type.\n"
"static erpc_status_t {$callbackType.name}_shim(uint32_t serviceID, uint32_t functionID, {$codecClass} * codec, MessageBufferFactory *messageFactory, uint32_t sequence);\n"
"{% endfor %}\n"
"{% for callbackType in group.callbacks %}\n"
"\n"
"// Common function for serializing and deserializing callback functions of same type.\n"
"static erpc_status_t {$callbackType.name}_shim(uint32_t serviceID, uint32_t functionID, {$codecClass} * codec, MessageBufferFactory *messageFactory, uint32_t sequence)\n"
"{\n"
"{$ serverShimCode(callbackType, \"serviceID\", \"functionID\") >}\n"
"}\n"
"{% endfor %}\n"
"{% for iface in group.interfaces -- service subclass method impl %}\n"
"\n"
"// Call the correct server shim based on method unique ID.\n"
"erpc_status_t {$iface.serviceClassName}::handleInvocation(uint32_t methodId, uint32_t sequence, Codec * codec, MessageBufferFactory *messageFactory)\n"
"{\n"
"    erpc_status_t erpcStatus;\n"
"{%  if codecClass != \"Codec\" %}\n"
"    {$codecClass} *_codec = static_cast<{$codecClass} *>(codec);\n"
"{%   endif %}\n"
"    switch (methodId)\n"
"    {\n"
"{%  for fn in iface.functions %}\n"
"        case k{$iface.name}_{$fn.name}_id:\n"
"        {\n"
"            erpcStatus = {$fn.name}_shim({%if codecClass == \"Codec\"%}codec{% else %}_codec{% endif %}, messageFactory, sequence);\n"
"            break;\n"
"        }\n"
"\n"
"{%  endfor -- fn %}\n"
"        default:\n"
"        {\n"
"            erpcStatus = kErpcStatus_InvalidArgument;\n"
"            break;\n"
"        }\n"
"    }\n"
"\n"
"    return erpcStatus;\n"
"}\n"
"{%  for fn in iface.functions %}\n"
"\n"
"// Server shim for {$fn.name} of {$iface.name} interface.\n"
"erpc_status_t {$iface.serviceClassName}::{$fn.name}_shim({$codecClass} * codec, MessageBufferFactory *messageFactory, uint32_t sequence)\n"
"{\n"
"{% if fn.isCallback %}\n"
"    return {$fn.callbackFName}_shim(k{$iface.name}_service_id, k{$iface.name}_{$fn.name}_id, codec, messageFactory, sequence);\n"
"{% else -- fn.isCallback >%}\n"
"{$ serverShimCode(fn, \"k\"& iface.name & \"_service_id\", \"k\" & iface.name & \"_\" & fn.name & \"_id\") >}\n"
"{% endif -- fn.isCallback >%}\n"
"}\n"
"{%  endfor -- fn %}\n"
"{% endfor -- iface %}\n"
"{% for iface in group.interfaces %}\n"
"\n"
"{% if dynamicServices == true %}\n"
"erpc_service_t create_{$iface.serviceClassName}()\n"
"{\n"
"    return new (nothrow) {$iface.serviceClassName}();\n"
"}\n"
"\n"
"void destroy_{$iface.serviceClassName}(erpc_service_t *service)\n"
"{\n"
"    if (*service)\n"
"    {\n"
"        delete service;\n"
"    }\n"
"}\n"
"{% else --dynamicServices == true %}\n"
"erpc_service_t create_{$iface.serviceClassName}()\n"
"{\n"
"    s_{$iface.serviceClassName}.construct();\n"
"    return s_{$iface.serviceClassName}.get();\n"
"}\n"
"\n"
"void destroy_{$iface.serviceClassName}()\n"
"{\n"
"    s_{$iface.serviceClassName}.destroy();\n"
"}\n"
"{% endif --dynamicServices == true %}\n"
"{% endfor -- iface %}\n"
;

